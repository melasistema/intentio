#!/usr/bin/env php
<?php

declare(strict_types=1);

use Intentio\Application\Kernel;

// Autoload Composer dependencies
require_once __DIR__ . '/vendor/autoload.php';

// Load configuration from config/app.php
$config = [];
$configPath = __DIR__ . '/config/app.php';
if (file_exists($configPath)) {
    $config = require $configPath;
}

// Load local overrides from config/app.local.php
$localConfigPath = __DIR__ . '/config/app.local.php';
if (file_exists($localConfigPath)) {
    $localConfig = require $localConfigPath;
    $config = array_replace_recursive($config, $localConfig); // Merge local config over base config
}

// Ensure essential paths are set in config
if (!isset($config['spaces_base_path'])) {
    $config['spaces_base_path'] = __DIR__ . '/spaces';
}
if (!isset($config['blueprints_base_path'])) {
    $config['blueprints_base_path'] = __DIR__ . '/packages';
}

// Run the application kernel
$kernel = new Kernel($config);
exit($kernel->run());
